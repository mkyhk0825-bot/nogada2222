<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì… ë…¸ê°€ë‹¤</title>
    <style>
        *{box-sizing:border-box;}
        body{
        margin:0;
        font-family:'Pretendard',sans-serif;
        background:linear-gradient(135deg,#141e30,#243b55);
        display:flex;
        justify-content:center;
        color:white;
        }
        .screen{
        width:100%;
        max-width:420px;
        min-height:100vh;
        display:none;
        position:relative;
        padding:20px;
        padding-bottom:90px;
        }
        .game-screen{
        background-size:cover;
        background-position:center;
        }
        .card{
        background:rgba(255,255,255,0.08);
        backdrop-filter:blur(12px);
        border-radius:20px;
        padding:15px;
        margin-bottom:15px;
        box-shadow:0 8px 25px rgba(0,0,0,0.3);
        }
        .shop-items{
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:14px;
        margin-top:15px;
        }
        .item{
        background:rgba(255,255,255,0.08);
        backdrop-filter:blur(8px);
        padding:12px;
        border-radius:18px;
        transition:0.2s;
        }
        .item:hover{
        transform:scale(1.05);
        }
        .item img{
        width:70px;
        height:70px;
        object-fit:contain;
        }
        button{
        padding:10px;
        border:none;
        border-radius:14px;
        background:linear-gradient(45deg,#00c6ff,#0072ff);
        color:white;
        margin-top:8px;
        width:100%;
        cursor:pointer;
        font-weight:bold;
        transition:0.2s;
        }
        button:hover{
        opacity:0.85;
        transform:translateY(-2px);
        }
        input{
        width:100%;
        padding:10px;
        margin-top:8px;
        border-radius:10px;
        border:none;
        background:rgba(255,255,255,0.1);
        color:white;
        }
        .bottom-nav{
        position:fixed;
        bottom:0;
        width:100%;
        max-width:420px;
        display:none;
        background:rgba(0,0,0,0.6);
        backdrop-filter:blur(12px);
        display:flex;
        }
        .nav-btn{
        flex:1;
        text-align:center;
        padding:14px 0;
        font-size:14px;
        cursor:pointer;
        transition:0.2s;
        }
        .nav-btn:hover{
        background:rgba(255,255,255,0.1);
        }
        #furnitureArea,#petArea{
        position:absolute;
        width:100%;
        text-align:center;
        }
        #petArea{
        bottom:170px;
        }
        #furnitureArea{
        bottom:100px;
        }
        #furnitureArea img, #petArea img{
        width:50px;
        margin:6px;
        animation:float 3s ease-in-out infinite;
        }
        @keyframes float{
        0%{transform:translateY(0);}
        50%{transform:translateY(-5px);}
        100%{transform:translateY(0);}
        }
        /* ë¯¸ë‹ˆê²Œì„ ë°•ìŠ¤ */
        .mini-box{
        width:50px;
        height:50px;
        display:inline-block;
        margin:6px;
        border-radius:8px;
        cursor:pointer;
        }
        .delivery{
        background:#8d6e63;
        }
        .cleaning{
        background:#777;
        }
          #infoBox {
                    position: relative;
                    transition: all 0.3s ease;
                    overflow: hidden;
                }

                #infoBox.closed {
                    height: 40px;
                }

                #toggleInfoBtn {
                    position: absolute;
                    right: 10px;
                    top: 10px;
                    background: rgba(0,0,0,0.6);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 30px;
                    height: 30px;
                    cursor: pointer;
                }

    </style>
</head>
<body>
<!-- ì‹œì‘ í™”ë©´ -->
<div id="startScreen" class="screen" style="display:block;">
    <div class="card">
        <h2>ğŸ  ì¸ìƒ ì‹œì‘</h2>
        <input type="text" id="nameInput" placeholder="ë‹‰ë„¤ì„">
        <label>ì¶œê·¼</label>
        <input type="time" id="startTime" value="09:00">
        <label>í‡´ê·¼</label>
        <input type="time" id="endTime" value="18:00">
        <button onclick="startGame()">ì‹œì‘</button>
    </div>
</div>
<div id="gameScreen" class="screen game-screen">

    <div id="infoBox" class="card">
        <button id="toggleInfoBtn">â–²</button>

        <p id="workStatusText">â° ìƒíƒœ í™•ì¸ì¤‘...</p>
        <button onclick="startOvertime()">ğŸ”¥ ì—°ì¥ê·¼ë¬´</button>
        <h3 id="playerName"></h3>
        <p id="moneyText"></p>
        <p id="levelText"></p>
        <p id="rebirthText"></p>
        <p id="workTimeText"></p>
        <p>ğŸ’¸ ìë™ìˆ˜ìµ ë³´ë„ˆìŠ¤: <span id="autoBonusText">0</span>%</p>
        <p>ğŸ¶ í« ë³´ë„ˆìŠ¤ : <span id="petBonusText">0</span>%</p>
        <p>â¤ï¸ <span id="affectionText"></span> | ğŸ—‘ <span id="trashText"></span></p>

        <button onclick="cleanTrash()">ğŸ§¹ ì“°ë ˆê¸° ì²­ì†Œ (-70,000ì›)</button>
        <button onclick="giveTreat()">ğŸ– ê°„ì‹ ì£¼ê¸° (-8,000ì›)</button>
    </div>

    <div id="petArea"></div>
    <div id="furnitureArea"></div>

</div>

<!-- ìƒì  -->
<div id="shopScreen" class="screen">
    <div class="card">
        <h3>ìƒì </h3>
        <div class="shop-items">
            <div class="item">
                <img src="./images/bed.png">
                <p>ì¹¨ëŒ€ - 300,000ì›</p> <br>ìë™ìˆ˜ìµ +5%</p>
                <button onclick="buyFurniture('bed.png',300000,5)">êµ¬ë§¤</button>
            </div>
            <div class="item">
                <img src="./images/sofa.png">
                <p>ì†ŒíŒŒ - 500,000ì›</p> <br>ìë™ìˆ˜ìµ +10%</p>
                <button onclick="buyFurniture('sofa.png',500000,10)">êµ¬ë§¤</button>
            </div>
            <div class="item">
                <img src="./images/computer.png">
                <p>ì»´í“¨í„° - 1,000,000ì›</p> <br>ìë™ìˆ˜ìµ +15%</p>
                <button onclick="buyFurniture('computer.png',1000000,15)">êµ¬ë§¤</button>
            </div>
            <div class="item">
                <img src="./images/dog.png">
                <p>ê°•ì•„ì§€ - 700,000ì›<br>ìë™ìˆ˜ìµ +30%</p>
                <button onclick="buyPet('dog.png',700000,20)">êµ¬ë§¤</button>
            </div>
            <div class="item">
                <img src="./images/cat.png">
                <p>ê³ ì–‘ì´ - 700,000ì›<br>ìë™ìˆ˜ìµ +30%</p>
                <button onclick="buyPet('cat.png',700000,15)">êµ¬ë§¤</button>
            </div>
            <div class="item">
                <p><b>ğŸ  ì§‘ ì—…ê·¸ë ˆì´ë“œ</b></p>
                <p id="upgradeCostText"></p>
                <button onclick="upgradeHouse()">ì—…ê·¸ë ˆì´ë“œ</button>
            </div>
            <div class="item">
                <p><b>ğŸ” í™˜ìƒ (Lv.50 í•„ìš”)</b></p>
                <button onclick="rebirth()">í™˜ìƒí•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>

<!-- ì•Œë°” -->
<div id="parttimeScreen" class="screen">
    <div class="card">
        <h3>ğŸ’¼ ì•Œë°” ì„ íƒ</h3>
        <button onclick="startDeliveryGame()">ğŸ“¦ íƒë°° ì•Œë°”</button>
        <button onclick="startCleaningGame()">ğŸ§¹ ì²­ì†Œ ì•Œë°”</button>
        <div id="miniGameArea" style="margin-top:15px;"></div>
    </div>
</div>

<!-- í•˜ë‹¨ ë„¤ë¹„ -->
<div class="bottom-nav" id="navBar">
    <div class="nav-btn" onclick="goGame()">ğŸ  í™ˆ</div>
    <div class="nav-btn" onclick="openShop()">ğŸ›’ ìƒì </div>
    <div class="nav-btn" onclick="openPartTime()">ğŸ’¼ ì•Œë°”</div>
    <div class="nav-btn" onclick="resetGame()" style="background:#b71c1c;">ğŸ—‘ ì´ˆê¸°í™”</div>
</div>

<script>
    let money=100000;
    let houseLevel=1;
    let rebirthCount=0;
    let ownedPets=[];
    let ownedFurniture=[];
    let affection=100;
    let treatCost = 8000;
    let trash=0;
    let workStartHour = 9;
    let workEndHour = 18;
    let overtimeEndHour = null; // ì—°ì¥ê·¼ë¬´ìš© (ì§€ê¸ˆ ì•ˆ ì¨ë„ ë¯¸ë¦¬ ë‘ )
    let incomeInterval;

    let petBonusPercent = 0;
    ownedPets.forEach(p => petBonusPercent += p.bonus);

    // ğŸ”¥ í˜¸ê°ë„ê°€ 0ì´ë©´ ë³´ë„ˆìŠ¤ ì—†ìŒ
    if(affection <= 0){
        petBonusPercent = 0;
    }

    function buyPet(img, price, bonus){
        if(money < price) return alert("ëˆ ë¶€ì¡±");

        if(!ownedPets.find(p => p.name === img)){
            money -= price;
            let newPet = {name: img, bonus: bonus};
            ownedPets.push(newPet);
            renderPets();
            updateUI();
            saveGame();

            // ğŸ”¥ í˜¸ê°ë„ê°€ 0ì´ë©´, ì•Œë°” 3ë²ˆ í›„ ë„ë§
            if(affection <= 0){
                newPet.escapesIn = 3;  // ì•Œë°” 3ë²ˆ í›„ ë„ë§
            }
        }
    }

    function checkPetEscape(){
        ownedPets.forEach((p, idx) => {
            if(p.escapesIn !== undefined){
                p.escapesIn--;
                if(p.escapesIn <= 0){
                    alert("ğŸ˜¢ " + p.name + "ê°€ ë„ë§ê°”ìŠµë‹ˆë‹¤!");
                    ownedPets.splice(idx, 1);
                }
            }
        });
    }


    function startIncomeSystem(){
    if(incomeInterval) clearInterval(incomeInterval);

    incomeInterval=setInterval(()=>{

    let now = new Date();
    let currentTime = now.getHours() * 60 + now.getMinutes();

    let startTime = workStartHour * 60 + workStartMinute;
    let endTime = workEndHour * 60 + workEndMinute;

    let isWorkingTime = false;
    let isOvertime = false;

    // ğŸ”¹ ê¸°ë³¸ ê·¼ë¬´ì‹œê°„ ì²´í¬
    if(startTime < endTime){
        if(currentTime >= startTime && currentTime < endTime){
            isWorkingTime = true;
        }
    }else{
        if(currentTime >= startTime || currentTime < endTime){
            isWorkingTime = true;
        }
    }

    // ğŸ”¥ ì—°ì¥ê·¼ë¬´ ì²´í¬ (ê°€ì¥ ì¤‘ìš”)
    if(overtimeEndHour !== null){
        if(currentTime < overtimeEndHour){
            isWorkingTime = true;
            isOvertime = true;
        }else{
            overtimeEndHour = null;
        }
    }

    // ğŸ”¹ ìƒíƒœ í‘œì‹œ
    if(isOvertime){
        workStatusText.innerText = "ğŸ”¥ ì—°ì¥ê·¼ë¬´ì¤‘";
    }else if(isWorkingTime){
        workStatusText.innerText = "ğŸ’¼ ê·¼ë¬´ì¤‘";
    }else{
        workStatusText.innerText = "ğŸŒ™ í‡´ê·¼";
    }

    // âœ… ê·¼ë¬´ì¤‘ì¼ ë•Œë§Œ ìˆ˜ìµ ê³„ì‚°
    if(isWorkingTime){

    let base = 10500;

    // í™˜ìƒ ë³´ë„ˆìŠ¤
    let rebirthMultiplier = 1 + (rebirthCount * 0.2);

    // ğŸ”¥ ì „ì²´ ë³´ë„ˆìŠ¤ ê³„ì‚°
    let totalBonus = 0;

    // í« ë³´ë„ˆìŠ¤
    ownedPets.forEach(p => {
        if(affection > 0) totalBonus += p.bonus;
    });

    // ê°€êµ¬ ë³´ë„ˆìŠ¤
    ownedFurniture.forEach(f => {
        totalBonus += (f.bonus || 0);
    });

    // ğŸ”¥ í™˜ìƒ ë³´ë„ˆìŠ¤ ì¶”ê°€
    let rebirthBonusPercent = rebirthCount * 20;
    totalBonus += rebirthBonusPercent;

    // UI í‘œì‹œ
    autoBonusText.innerText = totalBonus;
    petBonusText.innerText = totalBonus;

    // ğŸ”¥ ìµœì¢… ìˆ˜ìµ ê³„ì‚°
    let total = base;
    total = Math.floor(total * (1 + totalBonus / 100));

    money += total;

    }

    updateUI();
    saveGame();

    },1000);
    }
    const gameScreen = document.getElementById("gameScreen");
    function updateHouse(){
    let stage=Math.ceil(houseLevel/10);
    if(stage>5) stage=5;
    gameScreen.style.backgroundImage="url('./images/house_lv"+stage+".png')";
    }

    function upgradeHouse(){
    let cost=houseLevel*500000;
    if(money<cost) return alert("ëˆ ë¶€ì¡±");
    money-=cost;
    houseLevel++;
    updateHouse();
    updateUI();
    saveGame();
    }

    function buyFurniture(img, price, bonus){
        if(money < price) return alert("ëˆ ë¶€ì¡±");
        if(!ownedFurniture.find(f => f.name === img)){
            money -= price;
            ownedFurniture.push({name: img, bonus: bonus}); // bonus ì¶”ê°€
            renderFurniture();
            updateUI();
            saveGame();
        }
    }

    function renderFurniture(){
    furnitureArea.innerHTML="";
    ownedFurniture.forEach(f=>{
    let img=document.createElement("img");
    img.src="./images/"+f;
    furnitureArea.appendChild(img);
    });
    }

    function buyPet(img,price,bonus){
    if(money<price) return alert("ëˆ ë¶€ì¡±");
    if(!ownedPets.find(p=>p.name===img)){
    money-=price;
    ownedPets.push({name:img,bonus:bonus});
    renderPets();
    updateUI();
    saveGame();
    }
    }

    function renderPets(){
    petArea.innerHTML="";
    ownedPets.forEach(p=>{
    let img=document.createElement("img");
    img.src="./images/"+p.name;
    petArea.appendChild(img);
    });
    }
    /* ì•Œë°” í™”ë©´ */
    function openPartTime(){
    hideAll();
    parttimeScreen.style.display="block";
    }

    /* íƒë°° ì•Œë°” */
    function startDeliveryGame(){
    miniGameArea.innerHTML="";
    let count=0;
    for(let i=0;i<10;i++){
    let box=document.createElement("div");
    box.className="mini-box delivery";
    box.onclick=()=>{
    box.remove();
    count++;

    if(count>=10){
    let reward=Math.floor(Math.random()*30000)+70000;
    money+=reward;
    trash++;
    if(affection > 0){
        affection--;
    }
    checkPetEscape();
    updateUI();
    saveGame();
    miniGameArea.innerHTML="<p>ğŸ‰ "+reward.toLocaleString()+"ì› íšë“!<br>ğŸ—‘ ì“°ë ˆê¸° +1</p>";
    }
    };
    miniGameArea.appendChild(box);
    }
    }

    /* ì²­ì†Œ ì•Œë°” */
    function startCleaningGame(){
    miniGameArea.innerHTML="";
    let count=0;
    for(let i=0;i<8;i++){
    let t=document.createElement("div");
    t.className="mini-box cleaning";
    t.onclick=()=>{
    t.remove();
    count++;
    if(count>=8){
    let reward=Math.floor(Math.random()*30000)+70000;
    money+=reward;
    trash++;
    if(affection > 0){
        affection--;
    }
    checkPetEscape();
    updateUI();
    saveGame();
    miniGameArea.innerHTML="<p>ğŸ§¹ "+reward.toLocaleString()+"ì› íšë“!<br>ğŸ—‘ ì“°ë ˆê¸° +1</p>";
    }
    };
    miniGameArea.appendChild(t);
    }
    }

    function updateUI(){

        moneyText.innerText="ğŸ’° "+money.toLocaleString();
        levelText.innerText="ğŸ  Lv."+houseLevel;
        rebirthText.innerText="ğŸ” í™˜ìƒ:"+rebirthCount;
        workTimeText.innerText=
    "â° "+String(workStartHour).padStart(2,"0")+":"+
    String(workStartMinute).padStart(2,"0")+
    " ~ "+
    String(workEndHour).padStart(2,"0")+":"+
    String(workEndMinute).padStart(2,"0");

        // ğŸ”¥ ì „ì²´ ë³´ë„ˆìŠ¤ ê³„ì‚°
        let totalBonus = 0;

        // í« ë³´ë„ˆìŠ¤
        ownedPets.forEach(p=>{
            if(affection > 0) totalBonus += p.bonus;
        });

        // ê°€êµ¬ ë³´ë„ˆìŠ¤
        ownedFurniture.forEach(f=>{
            totalBonus += (f.bonus || 0);
        });

        // ğŸ”¥ í™˜ìƒ ë³´ë„ˆìŠ¤
        totalBonus += rebirthCount * 20;

        autoBonusText.innerText = totalBonus;
        petBonusText.innerText = totalBonus;

        affectionText.innerText=affection;
        trashText.innerText=trash;

        let upgradeCost = houseLevel * 500000;
        upgradeCostText.innerText = "ë¹„ìš©: " + upgradeCost.toLocaleString() + "ì›";
    }
    function saveGame(){
    localStorage.setItem("saveData", JSON.stringify({
    money,
    houseLevel,
    rebirthCount,
    ownedPets,
    ownedFurniture,
    affection,
    trash,
    workStartHour,
    workStartMinute,
    workEndHour,
    workEndMinute,
    playerName:playerName.innerText
    }));
    }

    function loadGame(){
    let data=localStorage.getItem("saveData");
    if(!data) return false;
    let d=JSON.parse(data);
    money=d.money;
    houseLevel=d.houseLevel;
    rebirthCount=d.rebirthCount;
    ownedPets=d.ownedPets||[];
    ownedFurniture=d.ownedFurniture||[];
    affection=d.affection;
    trash=d.trash;
    workStartHour = d.workStartHour;
    workStartMinute = d.workStartMinute || 0;

    workEndHour = d.workEndHour;
    workEndMinute = d.workEndMinute || 0;
    playerName.innerText=d.playerName;
    updateHouse();
    renderFurniture();
    renderPets();
    updateUI();
    return true;
    }

    function resetGame(){
    if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?")){
    clearInterval(incomeInterval);
    localStorage.clear();
    location.reload();
    }
    }

    function showStartScreen(){
    document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
    navBar.style.display="none";
    startScreen.style.display="block";
    }

    function openShop(){hideAll();shopScreen.style.display="block";}
    function goGame(){hideAll();gameScreen.style.display="block";}

    function hideAll(){
    document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
    navBar.style.display="flex";
    }

    function rebirth(){
    if(houseLevel<50) return alert("50ë ˆë²¨ í•„ìš”");

     rebirthCount++;

    // ğŸ”¥ ì™„ì „ ì´ˆê¸°í™”
    houseLevel=1;
    money=100000;
    ownedPets=[];
    ownedFurniture=[];
    affection=100;
    trash=0;

    renderFurniture();
    renderPets();

    updateHouse();
    updateUI();
    saveGame();

    alert("í™˜ìƒ ì™„ë£Œ! ğŸ”¥ ì˜êµ¬ ìˆ˜ìµ +20%");
    }

    function giveTreat(){
        if(ownedPets.length === 0){
            alert("í«ì´ ì—†ì–´ìš”!");
            return;
        }

        if(money < treatCost){
            alert("ëˆì´ ë¶€ì¡±í•´ìš”! (-8,000ì›)");
            return;
        }

        money -= treatCost;
        affection += 5;
        if(affection > 100) affection = 100;

        updateUI();
        saveGame();

        alert("ğŸ– ê°„ì‹ ì£¼ê¸° ì™„ë£Œ! í˜¸ê°ë„ +5");
    }

    function cleanTrash(){
        if(trash <= 0){
            alert("ì²­ì†Œí•  ì“°ë ˆê¸°ê°€ ì—†ì–´!");
            return;
        }

        let cost = 70000;

        if(money < cost){
            alert("70,000ì›ì´ ë¶€ì¡±í•´!");
            return;
        }

        money -= cost;
        trash--;

        updateUI();
        saveGame();

        alert("ğŸ§¹ ì“°ë ˆê¸° 1ê°œ ì²­ì†Œ ì™„ë£Œ!");
    }

    function startGame(){
    let name=nameInput.value.trim();
    if(name===""){alert("ë‹‰ë„¤ì„ ì…ë ¥í•´ì¤˜");return;}
    let startParts = startTime.value.split(":");
    let endParts = endTime.value.split(":");

    workStartHour = parseInt(startParts[0]);
    workStartMinute = parseInt(startParts[1]);

    workEndHour = parseInt(endParts[0]);
    workEndMinute = parseInt(endParts[1]);
    playerName.innerText=name;
    hideAll();
    goGame();
    updateHouse();
    startIncomeSystem();
    updateUI();
    saveGame();
    }

    function renderFurniture(){
        furnitureArea.innerHTML="";
        ownedFurniture.forEach(f=>{
            let img=document.createElement("img");
            img.src="./images/"+f.name;
            furnitureArea.appendChild(img);
        });
    }

    window.onload=function(){
    let hasSave=loadGame();
    if(hasSave){
    hideAll();
    goGame();
    startIncomeSystem();
    }else{
    showStartScreen();
    }
    }

       const infoBox = document.getElementById("infoBox");
        const toggleBtn = document.getElementById("toggleInfoBtn");

        toggleBtn.addEventListener("click", () => {
            infoBox.classList.toggle("closed");

            if (infoBox.classList.contains("closed")) {
                toggleBtn.innerText = "â–¼";
            } else {
                toggleBtn.innerText = "â–²";
            }
        });

function startOvertime(){

    let hours = prompt("ëª‡ ì‹œê°„ ì—°ì¥í• ê¹Œ?");

    // ì·¨ì†Œ ëˆŒë €ì„ ë•Œ
    if (hours === null) {
        return;
    }

    // ê³µë°± ì œê±°
    hours = hours.trim();

    // ì•„ë¬´ê²ƒë„ ì•ˆ ì¼ì„ ë•Œ
    if (hours === "") {
        alert("ì‹œê°„ì„ ì…ë ¥í•´ì¤˜");
        return;
    }

    // ìˆ«ìë¡œ ë³€í™˜
    hours = Number(hours);

    // ìˆ«ì ê²€ì‚¬
    if (!Number.isInteger(hours) || hours <= 0) {
        alert("ì˜¬ë°”ë¥¸ ì‹œê°„ì„ ì…ë ¥í•´ì¤˜");
        return;
    }

    let now = new Date();
    let currentTime = now.getHours() * 60 + now.getMinutes();

    overtimeEndHour = currentTime + (hours * 60);

    alert("ğŸ”¥ " + hours + "ì‹œê°„ ì—°ì¥ê·¼ë¬´ ì‹œì‘!");
}

</script>
</body>
</html>
